# Comprehensive Verification Tools Guide

## ðŸš€ Quick Start

Run the complete verification suite:
```bash
export NEW_RELIC_API_KEY=your_api_key
./run-comprehensive-verification.sh
```

## ðŸ“‹ Available Verification Tools

### 1. Comprehensive Account Comparison (`comprehensive-account-comparison.js`)
**Purpose**: Deep analysis comparing your account with reference accounts across all aspects

**Features**:
- UI visibility field validation
- Entity synthesis checks  
- Event sample analysis
- Dimensional metrics validation
- Metric completeness scoring
- Data freshness monitoring
- AWS integration verification
- Message Queue UI visibility checks

**Usage**:
```bash
node comprehensive-account-comparison.js
```

**Key Checks**:
- âœ… `providerExternalId` field presence (CRITICAL)
- âœ… AWS account ID format (12 digits)
- âœ… Entity type fields
- âœ… Dimensional metrics coverage
- âœ… Message Queue UI data

### 2. UI Visibility Validator (`ultimate-verification-system/verification/test-runners/ui-visibility-validator.js`)
**Purpose**: Specialized validation for New Relic Message Queues UI requirements

**Features**:
- AWS field validation with scoring
- Entity field completeness
- Event type coverage
- Dimensional metrics analysis
- Direct UI visibility check
- Best configuration identification

**Usage**:
```bash
node ultimate-verification-system/verification/test-runners/ui-visibility-validator.js [account1] [account2] ...
```

### 3. Run Comprehensive Verification (`run-comprehensive-verification.sh`)
**Purpose**: Orchestrates all verification tools and generates actionable reports

**Features**:
- Runs all verification scripts
- Checks deployment status
- Generates NRQL queries
- Creates fix scripts
- Produces summary reports

**Output Files**:
- `VERIFICATION_SUMMARY.md` - Executive summary
- `comprehensive-comparison.log` - Detailed analysis
- `apply-fixes.sh` - Script to implement fixes
- `verification-queries.nrql` - Manual verification queries

## ðŸ” Critical Fields for UI Visibility

Based on our analysis, these fields are REQUIRED for data to appear in the Message Queues UI:

### AWS Provider Fields
```yaml
provider: "AwsMskBroker"           # or AwsMskCluster, AwsMskTopic
awsAccountId: "123456789012"       # 12-digit AWS account (NOT NR account)
awsRegion: "us-east-1"            
providerAccountId: "123456789012"  
providerExternalId: "123456789012" # CRITICAL - missing causes UI invisibility
instrumentation.provider: "aws"
```

### Entity Fields
```yaml
entity.type: "AWS_KAFKA_BROKER"    # or AWS_KAFKA_CLUSTER, AWS_KAFKA_TOPIC
entity.name: "cluster:broker-1"
entity.guid: "base64_encoded_guid"
```

## ðŸ“Š Reference Account Comparison

| Account | Score | UI Visible | Key Issue |
|---------|-------|------------|-----------|
| 3630072 | 98.9% | âŒ No | Missing `providerExternalId`, wrong account ID format |
| 3001033 | 43.2% | âŒ No | No MSK data, critical failures |
| 1 | 72.2% | âœ… Yes | Data freshness issues |
| 3026020 | 86.7% | âœ… Yes | Minor issues |

## ðŸ”§ Common Fixes

### 1. Add providerExternalId Field
```go
// In simple_transformer.go and dimensional_transformer.go
attribute.Attribute{Key: "providerExternalId", Value: s.config.AWSAccountID}
```

### 2. Use Real AWS Account ID
```go
// In config.go
awsAccountID := "123456789012" // NOT "3630072"
```

### 3. Enable Dimensional Metrics
```bash
export MSK_USE_DIMENSIONAL=true
export NRI_KAFKA_USE_DIMENSIONAL=true
```

### 4. Update Kubernetes ConfigMap
```yaml
env:
  AWS_ACCOUNT_ID: "123456789012"
  MSK_USE_DIMENSIONAL: "true"
  providerExternalId: "123456789012"
```

## ðŸ“ˆ Success Criteria

Your implementation is successful when:
1. âœ… UI Visibility Score > 90%
2. âœ… Data appears in Message Queues UI
3. âœ… All critical AWS fields present
4. âœ… Entity synthesis working
5. âœ… Dimensional metrics flowing

## ðŸš¨ Troubleshooting

If data doesn't appear in UI after fixes:
1. Wait 5-10 minutes for entity synthesis
2. Check `NrIntegrationError` for synthesis failures
3. Verify AWS account ID is 12 digits
4. Ensure `providerExternalId` matches `awsAccountId`
5. Run UI visibility validator to identify gaps

## ðŸ“š Additional Resources

- [verify-kafka-metrics.js](./verify-kafka-metrics.js) - Original verification script
- [Ultimate Verification System](./ultimate-verification-system/) - Complete test suite
- [MSK Implementation Guides](./MSK_*.md) - Detailed implementation docs

---
*Generated by Comprehensive Verification System*