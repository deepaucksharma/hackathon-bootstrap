name: Negative Control - Missing Provider
description: Test that entity synthesis fails without provider field
phase: baseline
category: negative-control

baseTemplate: awsmskbroker
entityType: broker

# Variables
clusterName: test-cluster-{{timestamp}}
brokerId: "1"

# Modifications to break synthesis
modifications:
  - action: remove
    field: provider

verification:
  waitTime: 30000
  checks:
    - type: entityShouldNotExist
      params:
        name: "{{entityName}}"
        type: AWS_KAFKA_BROKER
      
    - type: eventCountShouldBe
      params:
        eventType: AwsMskBrokerSample
        where: "entityName = '{{entityName}}'"
        count: 0
        operator: ">"
      
    - type: fieldShouldNotExist
      params:
        eventType: MessageQueueSample
        field: entity.guid
        where: "entity.name LIKE '%{{clusterName}}%'"