name: Test Entity Identifier Constraints
description: Validate identifier length and character constraints
phase: component-tests
category: identifier-validation

baseTemplate: awsmskcluster
entityType: cluster

variations:
  - name: Max Length Identifier (36 chars)
    clusterName: "cluster-abcdefghijklmnopqrstuvwxyz123"  # Exactly 36 chars
    verification:
      checks:
        - type: entityShouldExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_CLUSTER
            
  - name: Over Max Length (37+ chars)
    clusterName: "cluster-abcdefghijklmnopqrstuvwxyz1234"  # 37 chars
    modifications:
      - action: set
        field: encodeIdentifierInGUID
        value: true
    verification:
      checks:
        - type: entityShouldExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_CLUSTER
        - type: customQuery
          params:
            query: "FROM AwsMskClusterSample SELECT count(*) WHERE clusterName = '{{clusterName}}' SINCE 30 minutes ago"
            validation: "result.count > 0"
            
  - name: Special Characters (Should Fail)
    clusterName: "cluster-with-special-@#$%"
    verification:
      checks:
        - type: entityShouldNotExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_CLUSTER
            
  - name: Unicode Characters (Should Fail)
    clusterName: "cluster-unicode-café-λ"
    verification:
      checks:
        - type: entityShouldNotExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_CLUSTER
            
  - name: Empty Identifier (Should Fail)
    clusterName: ""
    verification:
      checks:
        - type: eventCountShouldBe
          params:
            eventType: AwsMskClusterSample
            where: "clusterName = ''"
            count: 0
            operator: ">"

# Test case sensitivity for topics
topicVariations:
  - name: Topic Case Sensitivity Test
    baseTemplate: awsmsktopic
    entityType: topic
    variations:
      - topicName: "MyTopic"
      - topicName: "mytopic"
      - topicName: "MYTOPIC"
    verification:
      checks:
        - type: customQuery
          params:
            query: "FROM AwsMskTopicSample SELECT uniques(provider.topicName), count(*) GROUP BY provider.topicName SINCE 30 minutes ago"
          name: Verify topics are case-sensitive