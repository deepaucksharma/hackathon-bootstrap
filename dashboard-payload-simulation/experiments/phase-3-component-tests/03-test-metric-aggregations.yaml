name: Test Metric Aggregation Requirements
description: Test which metric aggregations are required for synthesis
phase: component-tests
category: metric-requirements

baseTemplate: awsmskbroker
entityType: broker

variations:
  - name: Only Average Aggregation
    modifications:
      - action: remove
        field: provider.bytesInPerSec.Sum
      - action: remove
        field: provider.bytesInPerSec.Minimum
      - action: remove
        field: provider.bytesInPerSec.Maximum
      - action: remove
        field: provider.bytesInPerSec.SampleCount
        
  - name: Only Sum Aggregation
    modifications:
      - action: remove
        field: provider.bytesInPerSec.Average
      - action: remove
        field: provider.bytesInPerSec.Minimum
      - action: remove
        field: provider.bytesInPerSec.Maximum
      - action: remove
        field: provider.bytesInPerSec.SampleCount
        
  - name: No Aggregations
    modifications:
      - action: set
        field: provider.bytesInPerSec
        value: 1000000

verification:
  waitTime: 30000
  checks:
    - type: entityShouldExist
      params:
        name: "{{entityName}}"
        type: AWS_KAFKA_BROKER
        
    - type: metricShouldBePopulated
      params:
        entityName: "{{entityName}}"
        metricName: provider.bytesInPerSec
        eventType: AwsMskBrokerSample