{
  "name": "Kafka Topic Analysis - {{topicName}}",
  "description": "Detailed analysis of a specific Kafka topic from infrastructure data",
  "pages": [
    {
      "name": "Topic Overview",
      "description": "Key metrics and configuration for the topic",
      "widgets": [
        {
          "title": "Topic Configuration",
          "visualization": "billboard",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 4,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(topic.partitions.count) as 'Partitions', latest(topic.replicationFactor) as 'Replication Factor' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}'"
          }
        },
        {
          "title": "Message Throughput",
          "visualization": "billboard",
          "gridX": 5,
          "gridY": 1,
          "gridWidth": 4,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(topic.messagesInPerSecond), 1 second) as 'Messages In/sec', rate(sum(topic.messagesOutPerSecond), 1 second) as 'Messages Out/sec' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}'"
          }
        },
        {
          "title": "Data Volume",
          "visualization": "billboard",
          "gridX": 9,
          "gridY": 1,
          "gridWidth": 4,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(topic.sizeBytes) / 1024 / 1024 / 1024 as 'Size (GB)', latest(topic.retentionMs) / 1000 / 60 / 60 / 24 as 'Retention (Days)' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}'"
          }
        }
      ]
    },
    {
      "name": "Performance Trends",
      "description": "Topic performance metrics over time",
      "widgets": [
        {
          "title": "Message Rate Trend",
          "visualization": "area",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 12,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(topic.messagesInPerSecond), 1 second) as 'Messages In', rate(sum(topic.messagesOutPerSecond), 1 second) as 'Messages Out' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Byte Rate Trend",
          "visualization": "area",
          "gridX": 1,
          "gridY": 4,
          "gridWidth": 12,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(topic.bytesInPerSecond), 1 second) / 1024 / 1024 as 'MB In/sec', rate(sum(topic.bytesOutPerSecond), 1 second) / 1024 / 1024 as 'MB Out/sec' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Request Patterns",
          "visualization": "line",
          "gridX": 1,
          "gridY": 7,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(topic.fetchRequestsPerSecond), 1 second) as 'Fetch Requests/sec', rate(sum(topic.produceRequestsPerSecond), 1 second) as 'Produce Requests/sec' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Topic Size Growth",
          "visualization": "line",
          "gridX": 7,
          "gridY": 7,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT average(topic.sizeBytes) / 1024 / 1024 as 'Size (MB)' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}' TIMESERIES AUTO"
          }
        }
      ]
    },
    {
      "name": "Health & Diagnostics",
      "description": "Topic health indicators and potential issues",
      "widgets": [
        {
          "title": "Under-Replicated Partitions",
          "visualization": "billboard",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(topic.underReplicatedPartitions) WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}'",
            "thresholds": [
              { "value": 0, "color": "green" },
              { "value": 1, "color": "red" }
            ]
          }
        },
        {
          "title": "Average Message Size",
          "visualization": "billboard",
          "gridX": 7,
          "gridY": 1,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT (average(topic.bytesInPerSecond) / average(topic.messagesInPerSecond)) as 'Avg Message Size (bytes)' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}' AND topic.messagesInPerSecond > 0"
          }
        },
        {
          "title": "Partition Distribution (if available)",
          "visualization": "table",
          "gridX": 1,
          "gridY": 4,
          "gridWidth": 12,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(topic.partitions.count) as 'Total Partitions', latest(topic.replicationFactor) as 'Replication Factor', latest(topic.underReplicatedPartitions) as 'Under-Replicated' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}' FACET clusterName"
          }
        }
      ]
    },
    {
      "name": "Comparative Analysis",
      "description": "Compare this topic with others in the cluster",
      "widgets": [
        {
          "title": "Topic Size Comparison",
          "visualization": "bar",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(topic.sizeBytes) / 1024 / 1024 as 'Size (MB)' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND clusterName IN (FROM MessageQueue SELECT uniques(clusterName) WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}') FACET topicName LIMIT 20"
          }
        },
        {
          "title": "Topic Throughput Comparison",
          "visualization": "bar",
          "gridX": 7,
          "gridY": 1,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(topic.messagesInPerSecond + topic.messagesOutPerSecond), 1 second) as 'Total Messages/sec' WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND clusterName IN (FROM MessageQueue SELECT uniques(clusterName) WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND topicName = '{{topicName}}') FACET topicName LIMIT 20"
          }
        }
      ]
    }
  ],
  "variables": [
    {
      "name": "topicName",
      "type": "nrql",
      "title": "Topic",
      "query": "FROM MessageQueue SELECT uniques(topicName) WHERE entityType = 'MESSAGE_QUEUE_TOPIC' AND provider = 'kafka'"
    }
  ]
}