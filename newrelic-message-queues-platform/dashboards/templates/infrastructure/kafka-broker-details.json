{
  "name": "Kafka Broker Details - {{brokerName}}",
  "description": "Detailed metrics for a specific Kafka broker from infrastructure data",
  "pages": [
    {
      "name": "Broker Overview",
      "description": "Key performance indicators for the broker",
      "widgets": [
        {
          "title": "Broker Status",
          "visualization": "billboard",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 3,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(broker.cpu.usage) as 'CPU %', latest(broker.memory.usage) as 'Memory %', latest(broker.disk.usage) as 'Disk %' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}'"
          }
        },
        {
          "title": "Message Rate",
          "visualization": "billboard",
          "gridX": 4,
          "gridY": 1,
          "gridWidth": 3,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(broker.messagesInPerSecond), 1 second) as 'Messages In/sec', rate(sum(broker.messagesOutPerSecond), 1 second) as 'Messages Out/sec' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}'"
          }
        },
        {
          "title": "Network Throughput",
          "visualization": "billboard",
          "gridX": 7,
          "gridY": 1,
          "gridWidth": 3,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(broker.bytesInPerSecond), 1 second) / 1024 / 1024 as 'MB In/sec', rate(sum(broker.bytesOutPerSecond), 1 second) / 1024 / 1024 as 'MB Out/sec' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}'"
          }
        },
        {
          "title": "Partition Health",
          "visualization": "billboard",
          "gridX": 10,
          "gridY": 1,
          "gridWidth": 3,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT latest(broker.underReplicatedPartitions) as 'Under-Replicated', latest(broker.offlinePartitions) as 'Offline' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}'",
            "thresholds": [
              { "value": 0, "color": "green" },
              { "value": 1, "color": "red" }
            ]
          }
        }
      ]
    },
    {
      "name": "Performance Metrics",
      "description": "Detailed performance metrics over time",
      "widgets": [
        {
          "title": "CPU Usage Over Time",
          "visualization": "line",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT average(broker.cpu.usage) WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Memory Usage Over Time",
          "visualization": "line",
          "gridX": 7,
          "gridY": 1,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT average(broker.memory.usage) WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Message Rate Trends",
          "visualization": "area",
          "gridX": 1,
          "gridY": 4,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(broker.messagesInPerSecond), 1 second) as 'In', rate(sum(broker.messagesOutPerSecond), 1 second) as 'Out' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Byte Rate Trends",
          "visualization": "area",
          "gridX": 7,
          "gridY": 4,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(broker.bytesInPerSecond), 1 second) / 1024 / 1024 as 'MB In/sec', rate(sum(broker.bytesOutPerSecond), 1 second) / 1024 / 1024 as 'MB Out/sec' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Request Handler Performance",
          "visualization": "line",
          "gridX": 1,
          "gridY": 7,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT average(broker.requestHandlerIdlePercent) as 'Request Handler Idle %', average(broker.networkProcessorIdlePercent) as 'Network Processor Idle %' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Requests Per Second",
          "visualization": "line",
          "gridX": 7,
          "gridY": 7,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT rate(sum(broker.requestsPerSecond), 1 second) WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        }
      ]
    },
    {
      "name": "Storage & Replication",
      "description": "Disk usage and replication health",
      "widgets": [
        {
          "title": "Disk Usage Trend",
          "visualization": "line",
          "gridX": 1,
          "gridY": 1,
          "gridWidth": 12,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT average(broker.disk.usage) WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Replication Issues",
          "visualization": "area",
          "gridX": 1,
          "gridY": 4,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT sum(broker.underReplicatedPartitions) as 'Under-Replicated Partitions' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        },
        {
          "title": "Leader Elections",
          "visualization": "line",
          "gridX": 7,
          "gridY": 4,
          "gridWidth": 6,
          "gridHeight": 3,
          "config": {
            "nrqlQuery": "FROM MessageQueue SELECT average(broker.leaderElectionRate) as 'Leader Election Rate', sum(broker.uncleanLeaderElections) as 'Unclean Elections' WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND displayName = '{{brokerName}}' TIMESERIES AUTO"
          }
        }
      ]
    }
  ],
  "variables": [
    {
      "name": "brokerName",
      "type": "nrql",
      "title": "Broker",
      "query": "FROM MessageQueue SELECT uniques(displayName) WHERE entityType = 'MESSAGE_QUEUE_BROKER' AND provider = 'kafka'"
    }
  ]
}