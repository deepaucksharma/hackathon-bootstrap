domain: INFRA
type: MESSAGE_QUEUE_CLUSTER

# Synthesis rules for creating cluster entities from telemetry data
synthesis:
  rules:
    # Standard Kafka cluster synthesis
    - identifier: clusterName
      name: clusterName
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: KafkaClusterSample
        - attribute: clusterName
          present: true
      tags:
        provider:
          entityTagName: mq.provider
        environment:
        cloud.provider:
        cloud.region:
        cloud.availability_zone:
        k8s.cluster.name:
        k8s.namespace.name:
        instrumentation.provider:
          
    # AWS MSK cluster synthesis
    - identifier: clusterArn
      name: clusterName
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: AwsMskClusterSample
        - attribute: clusterArn
          present: true
      tags:
        clusterArn:
          entityTagName: aws.arn
        aws.region:
        provider:
          entityTagName: mq.provider
        environment:
        instrumentation.provider:
          
    # OpenTelemetry compatibility
    - identifier: cluster.name
      name: cluster.name
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: messaging.kafka.cluster.
        - attribute: cluster.name
          present: true
        - attribute: newrelic.source
          value: api.metrics.otlp
      tags:
        service.name:
        service.namespace:
        telemetry.sdk.name:
        telemetry.sdk.version:
        telemetry.sdk.language:
        cloud.provider:
        cloud.region:
        k8s.cluster.name:
      legacyFeatures:
        overrideGuidType: true

# Golden tags are the most important tags for this entity type
goldenTags:
  - account
  - accountId
  - mq.provider
  - environment
  - cloud.provider
  - cloud.region
  - k8s.cluster.name
  - instrumentation.provider

# Entity configuration
configuration:
  entityExpirationTime: EIGHT_DAYS
  alertable: true