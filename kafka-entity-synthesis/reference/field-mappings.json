{
  "description": "Field mappings and requirements for MSK entity visibility in New Relic UI",
  "critical_discovery": "Use cloud-integrations format, NOT cloudwatch-metric-streams",
  
  "event_types": {
    "cluster": {
      "eventType": "AwsMskClusterSample",
      "provider": "AwsMskCluster",
      "required_fields": [
        "entityName",
        "entityGuid", 
        "entityId",
        "provider",
        "providerAccountId",
        "providerAccountName",
        "providerExternalId",
        "collector.name",
        "instrumentation.provider",
        "awsAccountId",
        "awsRegion"
      ],
      "metrics": [
        "provider.activeControllerCount",
        "provider.offlinePartitionsCount",
        "provider.globalPartitionCount",
        "provider.globalTopicCount"
      ]
    },
    "broker": {
      "eventType": "AwsMskBrokerSample",
      "provider": "AwsMskBroker",
      "required_fields": [
        "entityName",
        "entityGuid",
        "provider",
        "providerAccountId",
        "providerAccountName",
        "providerExternalId",
        "collector.name",
        "instrumentation.provider",
        "awsAccountId",
        "awsRegion",
        "provider.brokerId",
        "provider.clusterName"
      ],
      "metrics": [
        "provider.bytesInPerSec",
        "provider.bytesOutPerSec",
        "provider.messagesInPerSec",
        "provider.cpuUser",
        "provider.cpuSystem",
        "provider.cpuIdle",
        "provider.leaderCount"
      ]
    },
    "topic": {
      "eventType": "AwsMskTopicSample",
      "provider": "AwsMskTopic",
      "required_fields": [
        "entityName",
        "entityGuid",
        "provider",
        "providerAccountId",
        "providerAccountName",
        "providerExternalId",
        "collector.name",
        "instrumentation.provider",
        "awsAccountId",
        "awsRegion",
        "provider.topicName",
        "provider.clusterName"
      ],
      "metrics": [
        "provider.messagesInPerSec",
        "provider.bytesInPerSec",
        "provider.bytesOutPerSec"
      ]
    }
  },
  
  "field_values": {
    "collector.name": {
      "required_value": "cloud-integrations",
      "note": "NOT cloudwatch-metric-streams"
    },
    "instrumentation.provider": {
      "required_value": "aws"
    },
    "collector.version": {
      "example": "release-1973",
      "note": "Optional but present in working accounts"
    },
    "provider": {
      "cluster": "AwsMskCluster",
      "broker": "AwsMskBroker", 
      "topic": "AwsMskTopic",
      "note": "Must match exactly - NOT just 'AwsMsk'"
    }
  },
  
  "metric_format": {
    "description": "All metrics must include aggregations",
    "required_aggregations": [
      ".Sum",
      ".Average",
      ".Maximum",
      ".Minimum",
      ".SampleCount"
    ],
    "example": {
      "provider.bytesInPerSec.Sum": 2000000,
      "provider.bytesInPerSec.Average": 1000000,
      "provider.bytesInPerSec.Maximum": 1500000,
      "provider.bytesInPerSec.Minimum": 500000,
      "provider.bytesInPerSec.SampleCount": 2
    }
  },
  
  "entity_naming": {
    "cluster": "{clusterName}",
    "broker": "{brokerId}:{clusterName}",
    "topic": "{clusterName}:{topicName}"
  },
  
  "ui_queries": {
    "description": "The UI runs these specific queries",
    "cluster_list": "FROM AwsMskClusterSample WHERE providerAccountId IS NOT NULL",
    "broker_details": "FROM AwsMskBrokerSample WHERE providerAccountId IS NOT NULL", 
    "topic_metrics": "FROM AwsMskTopicSample WHERE providerAccountId IS NOT NULL",
    "message_queue": "FROM MessageQueueSample WHERE provider = 'AwsMsk'"
  }
}