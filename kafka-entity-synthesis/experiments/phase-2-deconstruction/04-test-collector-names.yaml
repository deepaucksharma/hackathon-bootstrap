name: Test Collector Name Impact on UI Visibility
description: Validate which collector.name values enable UI visibility
phase: deconstruction
category: collector-validation

baseTemplate: awsmskbroker
entityType: broker

# Test different collector.name values
variations:
  - name: CloudWatch Metric Streams (Expected Success)
    modifications:
      - action: set
        field: collector.name
        value: cloudwatch-metric-streams
    verification:
      checks:
        - type: entityShouldBeInUi
          params:
            guid: "{{entityGuid}}"
          retries: 5
        - type: customQuery
          params:
            query: "FROM MessageQueueSample SELECT count(*) WHERE entity.guid = '{{entityGuid}}' SINCE 30 minutes ago"
            validation: "result.count > 0"
            
  - name: Cloud Integrations (Expected Success)
    modifications:
      - action: set
        field: collector.name
        value: cloud-integrations
    verification:
      checks:
        - type: entityShouldBeInUi
          params:
            guid: "{{entityGuid}}"
          retries: 5
            
  - name: NRI Kafka (Limited Visibility)
    modifications:
      - action: set
        field: collector.name
        value: nri-kafka
    verification:
      checks:
        - type: entityShouldExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_BROKER
        - type: customQuery
          params:
            query: "FROM MessageQueueSample SELECT count(*) WHERE entity.guid = '{{entityGuid}}' SINCE 30 minutes ago"
            validation: "result.count === 0"  # Should NOT appear in MessageQueueSample
            
  - name: Custom Collector (No Visibility)
    modifications:
      - action: set
        field: collector.name
        value: custom-kafka-collector
    verification:
      checks:
        - type: entityShouldNotExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_BROKER
            
  - name: Missing Collector Name (No Synthesis)
    modifications:
      - action: remove
        field: collector.name
    verification:
      checks:
        - type: entityShouldNotExist
          params:
            name: "{{entityName}}"
            type: AWS_KAFKA_BROKER

# Global verification after all variations
verification:
  waitTime: 45000
  checks:
    - type: customQuery
      params:
        query: "FROM AwsMskBrokerSample SELECT uniques(collector.name) WHERE clusterName = '{{clusterName}}' SINCE 1 hour ago"
      name: Verify all collector.name values were tested