name: Remove Entity Name
description: Test if entity synthesis works without entityName field
phase: deconstruction
category: critical-field-test

baseTemplate: awsmskbroker
entityType: broker

modifications:
  - action: remove
    field: entityName

verification:
  waitTime: 45000
  checks:
    - type: entityShouldNotExist
      params:
        name: "{{clusterName}}"
        type: AWS_KAFKA_BROKER
      
    - type: eventCountShouldBe
      params:
        eventType: AwsMskBrokerSample
        where: "entityGuid = '{{entityGuid}}'"
        count: 0
        operator: ">"
        
    - type: customQuery
      params:
        query: "FROM MessageQueueSample SELECT count(*) WHERE entity.guid = '{{entityGuid}}' SINCE 30 minutes ago"
        validation: "result.count === 0"