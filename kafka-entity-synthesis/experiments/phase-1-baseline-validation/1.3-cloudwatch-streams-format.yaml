name: "Phase 1 / Test 1.3: CloudWatch Metric Streams Format"
description: "Sends data using cloudwatch-metric-streams format. Expected to FAIL all UI checks."
basePayload:
  eventType: "AwsMskBrokerSample"
  timestamp: ${timestamp}
  entityName: "p1-cws-broker-${timestamp}"
  entityGuid: "dummy-guid-${timestamp}"
  provider: "AwsMskBroker"
  providerAccountId: "${accountId}"
  providerAccountName: "Test Account"
  providerExternalId: "123456789012"
  collector.name: "cloudwatch-metric-streams"
  collector.version: "0.0.0"
  instrumentation.provider: "aws"
  awsAccountId: "123456789012"
  awsRegion: "us-east-1"
  provider.clusterName: "test-cluster"
  provider.brokerId: "1"
  provider.bytesInPerSec.Sum: 2000000
  provider.bytesInPerSec.Average: 1000000
  provider.bytesInPerSec.Maximum: 1500000
  provider.bytesInPerSec.Minimum: 500000
  provider.bytesInPerSec.SampleCount: 2
  _experimentId: "${experimentId}"

verification:
  timeout: 300
  initialDelay: 30
  checks:
    - type: "entityExists"
      details: 
        entityName: "p1-cws-broker-${timestamp}"
        entityType: "AWS_KAFKA_BROKER"
    
    - type: "uiQuery"
      details:
        query: "FROM AwsMskBrokerSample SELECT count(*) WHERE entityName = 'p1-cws-broker-${timestamp}' SINCE 30 minutes ago"
    
    - type: "messageQueueSample"
      details:
        entityName: "p1-cws-broker-${timestamp}"
    
    - type: "entityIsVisibleInUi"
      details:
        entityName: "p1-cws-broker-${timestamp}"
        uiContext: "queuesAndStreams"

expectedOutcome: "entityIsVisibleInUi_FAIL"
keyInsight: "CloudWatch Metric Streams format does NOT work for Q&S UI visibility"